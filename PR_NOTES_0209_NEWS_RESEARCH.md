# 🔧 2026-02-09 개발 노트 — News Research 품질 대폭 개선

## 📌 개요

뉴스 리서치 노드의 기사 선별 정확도와 팩트 추출 품질을 대폭 향상시켰다.  
기존에는 관련 기사가 중복 제거에 과도하게 걸려 2개만 남는 문제가 있었으나,  
프롬프트 개선 + 우선순위 필터 + 중복 임계값 완화를 통해 **5개 기사에서 42개 팩트**를 추출하는 수준으로 끌어올렸다.

---

## 🔀 변경 사항

### 1. 기사 텍스트 처리 한도 확장 (8,000자 → 15,000자)
- **파일**: `news_research.py` (L763~764)
- **이유**: 8,000자 제한 시 장문 기사의 후반부에 있는 핵심 수치·인용이 잘려나감
- **효과**: 기사 후반부 킬러 포인트(직접 인용, 의외의 디테일) 확보

### 2. 자사 칭찬 → [업계] 분류 규칙 추가
- **파일**: `news_research.py` (L811~813)
- **이유**: 기업이 자사 제품에 대해 주장하는 내용("19개 벤치마크에서 경쟁력")이 facts에 섞이면 객관성 훼손
- **규칙**: 자사 칭찬은 facts가 아니라 opinions의 `[업계]` 태그로 자동 분류
- **예시**:
  - ❌ `facts`: "삼성 HBM 판매량 3배 증가 예상" 
  - ✅ `opinions [업계]`: "삼성전자는 올해 HBM 판매량이 전년 대비 3배 이상 증가할 것으로 예상하고 있다"

### 3. 팩트 개수 제한 해제
- **파일**: `news_research.py`
- **이유**: 이전에 7개 max 제한이 있었으나, 기사마다 유효 팩트 수가 다름
- **변경**: 제한 없이 관련 팩트 전부 추출 (기사당 7~10개 수준으로 자연스럽게 수렴)

### 4. A+B 우선순위 기사 필터 도입
- **파일**: `news_research.py` (L126~280)
- **이유**: 단순히 "관련 기사 번호"만 나열하면 핵심 기사가 누락될 수 있음
- **로직**:
  1. GPT가 주제에서 **그룹A (고유명사)** + **그룹B (핵심 개념)** 추출
  2. 기사를 **A+B** (둘 다 해당), **A만**, **B만** 3개 카테고리로 분류
  3. **A+B 기사 우선 선택** (최대 5개)
  4. 남은 슬롯은 **A/B 균등 배분**
- **예시**:
  ```
  그룹A: 삼성전자, 엔비디아, HBM4, SK하이닉스
  그룹B: HBM4 기술, 반도체 기술 경쟁, 차세대 반도체
  A+B기사: 1, 3, 6, 10, 20  ← 최우선
  A기사: 2, 4, 5             ← 남은 슬롯
  B기사: 8, 19               ← 남은 슬롯
  ```

### 5. 중복 제거 임계값 완화
- **파일**: `news_research.py` (L362~363)
- **이유**: 제목 유사도 40%가 너무 공격적 → "HBM4"만 공통이어도 같은 기사로 판정
- **변경**:
  | 항목 | Before | After |
  |------|--------|-------|
  | 제목 유사도 | 0.40 | **0.65** |
  | 키워드 유사도 | 0.50 | **0.60** |
  | 설명 유사도 | 0.70 | 0.70 (유지) |
- **효과**: 5개 → 2개로 죽던 기사가 **5개 전부 생존**

### 6. 팩트 추출 프롬프트 4유형 분류 체계
- **파일**: `news_research.py` (L793~810)
- **유형 분류**:
  - `[유형A: 핵심 수치]` — 임팩트 있는 숫자 (금액, 비율, 건수)
  - `[유형B: 사건·행위]` — 누가 무엇을 했는지 (스토리)
  - `[유형C: 직접 인용]` — 기사 속 인물의 원문 발언
  - `[유형D: 의외의 디테일]` — 시청자가 놀랄만한 에피소드, 반전
- **효과**: 유튜버가 스크립트에서 바로 인용할 수 있는 구조

---

## 📊 Before vs After 비교

| 항목 | Before | After |
|------|--------|-------|
| 기사 텍스트 한도 | 8,000자 | **15,000자** |
| 최종 기사 수 | 2개 | **5개** |
| 팩트 총 수 | ~15개 | **42개** |
| 자사 칭찬 처리 | 팩트에 섞임 | **[업계] 분리** |
| 팩트 유형 구분 | 없음 | **A/B/C/D 4유형** |
| 기사 선별 방식 | 번호 나열 | **A+B 우선순위** |
| 중복 제거 | 과도 (40%) | **완화 (65%)** |
| Writer 팩트 인용 | 10개 | **9개 (소스 다양화)** |
| Verifier 통과율 | 15/15 | **19/19** |

---

## 🧪 테스트 결과

**주제**: `급변하는 반도체 시장, HBM4 기술 경쟁의 승자는? 삼성 vs 엔비디아`

### 수집된 기사 5개:
1. **한국경제** — `[단독] 최태원·젠슨 황 '치맥회동'…HBM4 초밀착` (facts: 10, opinions: 3)
2. **조선비즈** — `HBM4, 아직 결론은 없다…설왕설래 속 삼성·SK, '준비 경쟁' 돌입` (facts: 9, opinions: 2)
3. **TV조선** — `삼성전자, 설 연휴 뒤 세계 최초 HBM4 양산` (facts: 8, opinions: 2)
4. **SBS Medianet** — `삼성전자, HBM4 최초 양산…차세대 메모리 주도권 쥔다` (facts: 7, opinions: 1)
5. **언론사 미상** — `엔비디아 '베라 루빈' 탑재 HBM4, SK 70%·삼성 30%` (facts: 8, opinions: 2)

### 품질 검증 포인트:
- ✅ 자사 칭찬("HBM 판매량 3배 증가")이 [업계] opinion으로 정확히 분류됨
- ✅ 직접 인용이 원문 큰따옴표 유지된 채 추출됨
- ✅ 의외의 디테일("업계 유일 공정 조합", "루머 vs 분석 수치 엇갈림") 포착
- ✅ 5개 기사가 각각 다른 각도(양산, 경쟁, 협력, 점유율, 스펙)에서 주제를 다룸

---

## 📂 수정 파일

| 파일 | 변경 내용 |
|------|----------|
| `BE/src/script_gen/nodes/news_research.py` | 프롬프트 개선, 우선순위 필터, 중복 임계값 완화, 텍스트 한도 확장 |

---

## 🔜 향후 개선 포인트

- `MAX_ARTICLES = 5` 하드코딩 → 상수 분리 (필요 시)
- 영상 길이별 기사 수 자동 조절 (10분 = 5개, 20분 = 7개 등)
- 기사별 중복 팩트 cross-check (기사 간 같은 수치 반복 제거)
